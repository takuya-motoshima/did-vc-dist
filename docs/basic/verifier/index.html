<!DOCTYPE html>
<html lang="ja" data-bs-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>認証アプリ - DID/VC認証基盤</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script type="module" crossorigin src="../assets/js/verifier-Cy09tVJo.js"></script>
  <link rel="modulepreload" crossorigin href="../assets/js/style-D-PBLulJ.js">
  <link rel="modulepreload" crossorigin href="../assets/js/vcManager-BMuxMvip.js">
  <link rel="stylesheet" crossorigin href="../assets/css/main-YZ1fVskN.css">
</head>
<body>
  <div class="container py-3">
    <div class="text-center mb-3">
      <h1 class="h2">認証アプリ</h1>
    </div>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">

        <!-- 認証シナリオ選択 -->
        <div id="step1" class="step-content">
          <div class="card border-0">
            <div class="card-header bg-white border-0">
              <h2 class="h5 mb-0">認証シナリオ選択</h2>
              <small class="text-muted">シナリオを選択すると、自動でカメラが起動してQRコード読み取り待機状態になります。VP提示アプリで生成されたQRコードをカメラにかざしてください。</small>
            </div>
            <div class="card-body">
              <div class="d-grid gap-3 mb-4">
                <button class="btn scenario-btn text-start p-3" id="identity-scenario-btn" data-scenario="identity">
                  <h6 class="mb-1 text-white-on-hover">
                    <i class="fas fa-id-card me-2"></i>本人確認
                  </h6>
                  <small class="mb-0 text-muted text-white-on-hover">氏名・生年月日・住所を含む完全な身元認証を実行</small>
                </button>

                <button class="btn scenario-btn text-start p-3" id="age-scenario-btn" data-scenario="age">
                  <h6 class="mb-1 text-white-on-hover">
                    <i class="fas fa-calendar-check me-2"></i>年齢認証
                  </h6>
                  <small class="mb-0 text-muted text-white-on-hover">成人年齢のみを認証（プライバシー保護・個人情報非開示）</small>
                </button>
              </div>

              <!-- === 開発用テストボタン（?dev=1 パラメータで表示制御） === -->
              <div id="dev-tools" class="mt-4" style="display: none;">
                <div class="d-grid gap-2">
                  <button class="btn btn-dark btn-sm" id="test-success-btn">成功テスト</button>
                  <button class="btn btn-dark btn-sm" id="test-failure-btn">失敗テスト</button>
                </div>
              </div>
              <!-- === 開発用テストボタン終了 === -->

            </div>
          </div>
        </div>
        
        <!-- VP読取エリア -->
        <div id="vp-scan-area" class="mt-1" style="display: none;">
          <div class="card border-0">
            <div class="card-header bg-white border-0">
              <h2 class="h5 mb-0">QRコードを読み取り</h2>
            </div>
            <div class="card-body">
              
              <div class="text-center mb-4">
                <div id="qr-reader" class="rounded border" style="width: 100%; max-width: 400px; margin: 0 auto; aspect-ratio: 1; background-color: #000;"></div>
              </div>

              
              <!-- VPデータ直接入力（将来使用する可能性があるためコメントアウト）
              <div class="text-center mb-3">
                <span class="text-muted">— または —</span>
              </div>

              <div class="mb-3">
                <label for="vpData" class="form-label">VPデータ直接入力</label>
                <textarea class="form-control" id="vpData" rows="3" placeholder="VPデータを入力してください..."></textarea>
              </div>
              -->
              
            </div>
          </div>
        </div>
        
        <!-- 認証結果エリア -->
        <div id="result-area" class="mt-4" style="display: none;">
          <div class="card border-0">
            <div class="card-header bg-white border-0">
              <h2 class="h5 mb-0">認証結果</h2>
            </div>
            <div class="card-body">
              <!-- 成功例 -->
              <div class="alert alert-success">
                <div class="d-flex align-items-center mb-3">
                  <div class="rounded-circle bg-success text-white d-inline-flex align-items-center justify-content-center me-3" style="width: 48px; height: 48px;">
                    <strong>✓</strong>
                  </div>
                  <div>
                    <h5 class="mb-0">認証成功</h5>
                    <small>VPの真正性が確認されました</small>
                  </div>
                </div>
                
                <hr>
                
                <div class="row">
                  <div class="col-md-6">
                    <p class="mb-2"><strong>認証方式:</strong> 本人確認</p>
                    <p class="mb-2"><strong>発行機関:</strong> DID認証機構</p>
                    <p class="mb-0"><strong>認証日時:</strong> 2024-01-15 14:30:34</p>
                  </div>
                  <div class="col-md-6">
                    <h6>認証済み属性情報:</h6>
                    <ul class="mb-0 small">
                      <li>氏名: 山田 太郎</li>
                      <li>生年月日: 1990年5月15日</li>
                      <li>住所: 東京都千代田区霞が関1-1-1</li>
                    </ul>
                  </div>
                </div>
              </div>
              
              <!-- 失敗例（非表示） -->
              <div class="alert alert-danger" style="display: none;">
                <div class="d-flex align-items-center mb-3">
                  <div class="rounded-circle bg-danger text-white d-inline-flex align-items-center justify-content-center me-3" style="width: 48px; height: 48px;">
                    <strong>✗</strong>
                  </div>
                  <div>
                    <h5 class="mb-0">認証失敗</h5>
                    <small>VPの認証に失敗しました</small>
                  </div>
                </div>
                <hr>
                <p class="mb-0"><strong>エラー:</strong> デジタル署名の認証に失敗しました。VPが改ざんされている可能性があります。</p>
              </div>
              
              <div class="d-grid">
                <button class="btn btn-dark btn-lg" id="reset-to-start-btn">最初から</button>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <style>
    /* QRリーダーのコンテナ調整 */
    #qr-reader {
      overflow: hidden !important;
      padding: 0 !important;
      line-height: 0 !important;
      aspect-ratio: 1 !important;
      height: auto !important;
    }

    /* カメラビデオ要素のサイズ強制設定 */
    #qr-reader video {
      width: 100% !important;
      height: 100% !important;
      object-fit: cover !important;
      display: block !important;
      margin: 0 !important;
      padding: 0 !important;
    }

    /* html5-qrcodeライブラリが生成する要素の調整 */
    #qr-reader > div {
      margin: 0 !important;
      padding: 0 !important;
      width: 100% !important;
      height: 100% !important;
    }

    /* レスポンシブ対応 */
    @media (max-width: 480px) {
      #qr-reader {
        max-width: 300px !important;
      }
    }
  </style>

</body>
</html>